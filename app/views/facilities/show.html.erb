<div class="facility-show">
  <div class="facility-show--info">
    <h2 class="title_border">施設情報</h2>
    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>施設名</p>
      </div>
      <div class="facility-show--details__data">
        <%= @facility.name %>
        <% if current_user %>
          <span id = "facility-favorite">
            <%= render 'facility_favorites/like', facility: @facility %>
          </span>
        <% end %>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>営業時間</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.opening.strftime("%H時%M分") %> ~ <%= @facility.closing.strftime("%H時%M分") %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>郵便番号</p>
      </div>
      <div class="facility-show--details__data">
        <p>〒<%= @facility.postcode %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>住所</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.address %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>最寄り駅</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.station %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>駐車場</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.parking %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>電話番号</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.phone_number %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>メールアドレス</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.email %></p>
      </div>
    </div>

    <div class="facility-show--photo">
      <%= attachment_image_tag(@facility, :facility_image, fallback: "no_image.jpg") %>
    </div>
  </div>
  <div class="facility-show--map">
    <div class="show__maps" id="show_map"></div>
  </div>

  <div class="facility-show--function">
    <div class="facility-show--function__detail">
       <% if current_user %>
        <div class="facility-show--new-reserve">
          <h2 class="title_border">Reserve</h2>
          <%= form_with(model: [@facility, @reserve_facility], local: true) do |f| %>
            <div class="facility-show--details-reserve">
              <div class="facility-show--details__title-reserve">
                <%= f.label :開始 %>
              </div>
              <div class="facility-show--details__data-reserve">
                <%= render "layouts/error_messages", model: @reserve_facility, attribute: :start %>
                <%= f.datetime_field :start %><br>
              </div>
            </div>

            <div class="facility-show--details-reserve">
              <div class="facility-show--details__title-reserve">
                <%= f.label :終了%>
              </div>
              <div class="facility-show--details__data-reserve">
                <%= render "layouts/error_messages", model: @reserve_facility, attribute: :finish %>
                <%= f.datetime_field :finish, minute_step: 30 %><br>
              </div>
            </div>

            <div class="facility-show--details-reserve">
              <div class="facility-show--details__title-reserve">
                <%= f.label :人数 %>
              </div>
              <div class="facility-show--details__data-reserve">
                <%= render "layouts/error_messages", model: @reserve_facility, attribute: :number %>
                <%= f.select :number, [1,2,3,4,5,6,7,8,9,10], {}, prompt: "参加予定人数を選択してください" %>名<br>
              </div>
            </div>

            <div class="facility-show--details-reserve">
              <div class="facility-show--details__title-reserve">
                <%= f.label :合流可否 %>
              </div>
              <div class="facility-show--details__data-reserve">
                <%= render "layouts/error_messages", model: @reserve_facility, attribute: :with_friend %>
                <%= f.radio_button :with_friend, :false %>
                <%= f.label :with_friend, "参加不可", {value: :false, style: "display: inline;"} %>
                <%= f.radio_button :with_friend, :true, class:"ml-5"%>
                <%= f.label :with_friend, "一緒に参加可", {value: :true, style: "display: inline;"}%><br>
                (※一緒に参加可にすると予約情報を閲覧した人があなたのMyPageに飛べるようになります。)
              </div>
            </div>

            <div class="facility-show--details-reserve">
              <div class="facility-show--details__title-reserve">
                <%= f.label :コメント %>
              </div>
              <div class="facility-show--details__data-reserve">
                <%= f.text_area :comment, placeholder: "コメントがあれば記載してください", size: "40x5" %><br>
                <%= f.submit "予約する", class: "btn btn-success" %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="facility-show--calendar" style="width: 45%;">
      <div id="calendar"></div>
    </div>
  </div>
  <div class="facility-show--rate-comment">
    <div class="facility-show--rate">
      <h2 class="title_border">Facility Evaluation</h2>
      <div id="evaluate_stars_avg">
        <label>平均評価</label>
        <script>
          $('#evaluate_stars_avg').raty({
            size: 36,
            starOff: '<%= asset_path('star-off.png') %>',
            starOn: '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= @facility_comments.average(:rate).to_f.round(1) %>,
          });
        </script>
      </div>
      <div class="facility-show--graph">
        <% if @facility_comments.present? %>
          <%= bar_chart @data, colors: ["orange"], min: 0, max: 100 %>
        <% else %>
          コメントがありません
        <% end %>
      </div>
  　</div>

    <div class="facility-show--comment-form">
      <h2 class="title_border">Comments（<%= @facility_comments.count %>件）</h2>
      <% if current_user %>
        <div id="facility-show--new-comment">
          <%= form_with(model: [@facility, @comment]) do |f| %>
            <div id="evaluate_stars">
              <label>評価</label>
              <script>
                $('#evaluate_stars').raty({
                  starOn: "<%= asset_path('star-on.png') %>",
                  starOff: "<%= asset_path('star-off.png') %>",
                  starHalf: "<%= asset_path('star-half.png') %>",
                  scoreName: 'facility_comment[rate]'
                });
              </script>
            </div>
            <%= f.label :comment %><br>
            <%= f.text_area :comment %>
            <%= f.submit "コメントする" %>
          <% end %>
        </div>
      <% end %>

      <div id="facility-show--comments">
        <%= render "facility_comments/index", facility_comments: @facility_comments %>
      </div>
    </div>
  </div>
</div>

<!--カレンダーのモーダルウィンドウ-->
<div id="calendarModal" class="modal fade">
  <%= render "reserve_facilities/modal" %>
</div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKzm8Q1CsziI929WJM-dQQlwV1L3MpydY&callback=initMap"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src="//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js", type:"text/javascript"></script>