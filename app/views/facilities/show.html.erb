<div class="facility-show">
  <div class="facility-show--info">
    <h2>施設情報</h2>
    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>施設名</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.name %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>営業時間</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.opening.strftime("%H時%M分") %> ~ <%= @facility.closing.strftime("%H時%M分") %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>郵便番号</p>
      </div>
      <div class="facility-show--details__data">
        <p>〒<%= @facility.postcode %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>住所</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.address %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>最寄り駅</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.station %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>駐車場</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.parking %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>電話番号</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.phone_number %></p>
      </div>
    </div>

    <div class="facility-show--details">
      <div class="facility-show--details__title">
        <p>メールアドレス</p>
      </div>
      <div class="facility-show--details__data">
        <p><%= @facility.email %></p>
      </div>
    </div>

    <% if current_user %>
      <div id = "favorites_btn_<%= @facility.id %>">
        いいね<%= render 'facility_favorites/like', facility: @facility %>
      </div>
    <% end %>

    <div class="facility-show--photo">
      <%= attachment_image_tag(@facility, :facility_image, fallback: "no_image.jpg") %>
    </div>
  </div>

  <div class="facility-show--map">
    <div class="show__maps" id="show_map"></div>
  </div>

   <% if current_user %>
    <div class="facility-show--new-reserve">
      <h2>Reserve</h2>
      <%= form_with(model: [@facility, @reserve_facility], local: true) do |f| %>
        <%= f.label :日時 %>
        <%= f.datetime_field :start %>
        <%= f.datetime_field :finish %>
        <%= f.label :人数 %>
        <%= f.text_field :number %>
        <%= f.submit "予約する" %>
      <% end %>
    </div>
  <% end %>

  <div class="facility-show--calendar">
    <div id="calendar"></div>
  </div>


  <div class="facility-show--rate-comment">
    <div class="facility-show--rate">
        <h2>Facility Evaluation</h2>
        <div id="evaluate_stars_avg">
          <label>平均評価</label>
          <script>
            $('#evaluate_stars_avg').raty({
              size: 36,
              starOff: '<%= asset_path('star-off.png') %>',
              starOn: '<%= asset_path('star-on.png') %>',
              starHalf: '<%= asset_path('star-half.png') %>',
              half: true,
              readOnly: true,
              score: <%= @facility_comments.average(:rate).to_f.round(1) %>,
            });
          </script>
        </div>
      <% if @facility_comments.present? %>
        <%= bar_chart @data, colors: ["orange"], min: 0, max: 100 %>
      <% else %>
        コメントがありません
      <% end %>
  　</div>

    <div class="facility-show--comments">
      <h2>Comments（<%= @facility_comments.count %>件）</h2>
      <% if current_user %>
        <div class="facility-show--new-comment">
          <%= form_with(model: [@facility, @comment], local: true) do |f| %>
            <div id="evaluate_stars">
              <label>評価</label>
            </div>
            <%= f.label :comment %><br>
            <%= f.text_area :comment %>
            <%= f.submit "コメントする" %>
          <% end %>
        </div>
      <% end %>

      <div class="facility-show--comments">
        <%= render "facility_comments/index", facility_comments: @facility_comments %>
      </div>
    </div>
  </div>
</div>


  <script>
    $('#evaluate_stars').raty({
      starOn: "<%= asset_path('star-on.png') %>",
      starOff: "<%= asset_path('star-off.png') %>",
      starHalf: "<%= asset_path('star-half.png') %>",
      scoreName: 'facility_comment[rate]'
    });
  </script>


<div id="calendarModal" class="modal fade">
  <div class="modal-dialog modal-dialog-center">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">×</span>
          <span class="sr-only">close</span>
        </button>
        <span id="modalTitle" class="modal-title"></span>
      </div>
      <div id="modalBody" class="modal-body"></div>
      <div id="modalFooter" class="modal-footer"></div>
    </div>
  </div>
</div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKzm8Q1CsziI929WJM-dQQlwV1L3MpydY&callback=initMap"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src="//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js", type:"text/javascript"></script>